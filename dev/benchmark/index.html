<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Benchmark · OptimizationProblems.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="OptimizationProblems.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">OptimizationProblems.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../meta/">Problem classification</a></li><li class="is-active"><a class="tocitem" href>Benchmark</a></li><li><a class="tocitem" href="../reference/">Reference</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Benchmark</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Benchmark</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaSmoothOptimizers/OptimizationProblems.jl/blob/main/docs/src/benchmark.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Run-a-benchmark-with-OptimizationProblems.jl"><a class="docs-heading-anchor" href="#Run-a-benchmark-with-OptimizationProblems.jl">Run a benchmark with OptimizationProblems.jl</a><a id="Run-a-benchmark-with-OptimizationProblems.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Run-a-benchmark-with-OptimizationProblems.jl" title="Permalink"></a></h1><p>In this more advanced tutorial, we use the problems from <code>OptimizationProblems</code> to run a benchmark for unconstrained problems. The tutorial will use:</p><ul><li><a href="https://github.com/JuliaSmoothOptimizers/JSOSolvers.jl">JSOSolvers</a>: This package provides optimization solvers in pure Julia for unconstrained and bound-constrained optimization.</li><li><a href="https://github.com/JuliaSmoothOptimizers/NLPModelsJuMP.jl">NLPModelsJuMP</a>: This package convert JuMP model in <code>NLPModel</code> format.</li><li><a href="https://github.com/JuliaSmoothOptimizers/SolverBenchmark.jl">SolverBenchmark</a>: This package provides general tools for benchmarking solvers.</li></ul><pre><code class="language-julia hljs">using JSOSolvers, NLPModels, NLPModelsJuMP, OptimizationProblems, SolverBenchmark
using OptimizationProblems.PureJuMP</code></pre><p>We select the problems from <code>PureJuMP</code> submodule of <code>OptimizationProblems</code> converted in <a href="https://github.com/JuliaSmoothOptimizers/NLPModels.jl">NLPModels</a> using <a href="https://github.com/JuliaSmoothOptimizers/NLPModelsJuMP.jl">NLPModelsJuMP</a>.</p><pre><code class="language-julia hljs">problems = (MathOptNLPModel(eval(Meta.parse(problem))(), name=problem) for problem ∈ OptimizationProblems.meta[!, :name])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Base.Generator{Vector{String}, Main.var&quot;#1#2&quot;}(Main.var&quot;#1#2&quot;(), [&quot;AMPGO02&quot;, &quot;AMPGO03&quot;, &quot;AMPGO04&quot;, &quot;AMPGO05&quot;, &quot;AMPGO06&quot;, &quot;AMPGO07&quot;, &quot;AMPGO08&quot;, &quot;AMPGO09&quot;, &quot;AMPGO10&quot;, &quot;AMPGO11&quot;  …  &quot;triangle&quot;, &quot;triangle_deer&quot;, &quot;triangle_pacman&quot;, &quot;triangle_turtle&quot;, &quot;tridia&quot;, &quot;vardim&quot;, &quot;vibrbeam&quot;, &quot;watson&quot;, &quot;woods&quot;, &quot;zangwil3&quot;])</code></pre><p>The same can be achieved using <code>OptimizationProblems.ADNLPProblems</code> instead of <code>OptimizationProblems.PureJuMP</code> as follows:</p><pre><code class="language-julia hljs">using ADNLPModels
using OptimizationProblems.ADNLPProblems
ad_problems = (eval(Meta.parse(problem))() for problem ∈ OptimizationProblems.meta[!, :name])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Base.Generator{Vector{String}, Main.var&quot;#3#4&quot;}(Main.var&quot;#3#4&quot;(), [&quot;AMPGO02&quot;, &quot;AMPGO03&quot;, &quot;AMPGO04&quot;, &quot;AMPGO05&quot;, &quot;AMPGO06&quot;, &quot;AMPGO07&quot;, &quot;AMPGO08&quot;, &quot;AMPGO09&quot;, &quot;AMPGO10&quot;, &quot;AMPGO11&quot;  …  &quot;triangle&quot;, &quot;triangle_deer&quot;, &quot;triangle_pacman&quot;, &quot;triangle_turtle&quot;, &quot;tridia&quot;, &quot;vardim&quot;, &quot;vibrbeam&quot;, &quot;watson&quot;, &quot;woods&quot;, &quot;zangwil3&quot;])</code></pre><p>We also define a dictionary of solvers that will be used for our benchmark. We consider here <code>JSOSolvers.lbfgs</code> and <code>JSOSolvers.trunk</code>.</p><pre><code class="language-julia hljs">solvers = Dict(
  :lbfgs =&gt; model -&gt; lbfgs(model, mem=5, atol=1e-5, rtol=0.0),
  :trunk =&gt; model -&gt; trunk(model, atol=1e-5, rtol=0.0),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Symbol, Function} with 2 entries:
  :trunk =&gt; #6
  :lbfgs =&gt; #5</code></pre><p>The function <code>SolverBenchmark.bmak_solvers</code> will run all the problems on the specified solvers and store the results in a <code>DataFrame</code>. At this stage, we discard the problems that have constraints or bounds using <code>!unconstrained(prob)</code>, and those that are too large or too small with <code>get_nvar(prob) &gt; 100 || get_nvar(prob) &lt; 5</code>.</p><pre><code class="language- hljs">stats = bmark_solvers(
  solvers, problems,
  skipif=prob -&gt; (!unconstrained(prob) || get_nvar(prob) &gt; 100 || get_nvar(prob) &lt; 5),
)</code></pre><p>We can explore the results solver by solver in <code>stats[:lbfgs]</code> and <code>stats[:trunk]</code>, or get a profile wall using <code>SolverBenchmark.profile_solvers</code>.</p><pre><code class="language- hljs">cols = [:id, :name, :nvar, :objective, :dual_feas, :neval_obj, :neval_grad, :neval_hess, :iter, :elapsed_time, :status]
header = Dict(
  :nvar =&gt; &quot;n&quot;,
  :objective =&gt; &quot;f(x)&quot;,
  :dual_feas =&gt; &quot;‖∇f(x)‖&quot;,
  :neval_obj =&gt; &quot;# f&quot;,
  :neval_grad =&gt; &quot;# ∇f&quot;,
  :neval_hess =&gt; &quot;# ∇²f&quot;,
  :elapsed_time =&gt; &quot;t&quot;,
)

for solver ∈ keys(solvers)
  pretty_stats(stats[solver][!, cols], hdr_override=header)
end</code></pre><pre><code class="language- hljs">first_order(df) = df.status .== :first_order
unbounded(df) = df.status .== :unbounded
solved(df) = first_order(df) .| unbounded(df)
costnames = [&quot;time&quot;, &quot;obj + grad + hess&quot;]
costs = [
  df -&gt; .!solved(df) .* Inf .+ df.elapsed_time,
  df -&gt; .!solved(df) .* Inf .+ df.neval_obj .+ df.neval_grad .+ df.neval_hess,
]

using Plots
gr()

profile_solvers(stats, costs, costnames)</code></pre><p>It is also possible to select problems when initializing the problem list by filtering <code>OptimizationProblems.meta</code>:</p><pre><code class="nohighlight hljs">meta = OptimizationProblems.meta
problem_list = meta[(meta.ncon .== 0) .&amp; .!meta.has_bounds .&amp; (5 .&lt;= meta.nvar .&lt;= 100), :name]
problems = (MathOptNLPModel(eval(Meta.parse(problem))(), name=problem) for problem ∈ problem_list)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../meta/">« Problem classification</a><a class="docs-footer-nextpage" href="../reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 25 May 2024 07:09">Saturday 25 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
